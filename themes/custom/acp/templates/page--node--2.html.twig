{% include '@acp/sec-header.html.twig' %}
{# Contact Us #}

<div class="mb-92 bg-[#009595]" style="margin-bottom:200px;" >
  <div class="max-h-screen py-20 container mx-auto px-4 xl:px-16 pb-10 md:pt-28 gap-5 flex flex-col items-center justify-center">
    <div id="pageNavigation" class="flex gap-1 my-6 items-center container mx-auto">
      {% if language.id == 'ar' %}
        <a href="{{ path('<front>') }}" class="text-gray-100 hover:text-gray-200">الرئيسية</a>

        <!-- Separator (Arrow pointing left for Arabic) -->
        <svg class="w-4 h-4 text-green-400 rotate-180" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>

        <!-- Contact Us (Arabic) -->
        <a href="{{ url('<front>') }}/node/2" class="text-green-400 hover:text-green-400">تواصل معنا</a>

      {% else %}
        <a href="{{ path('<front>') }}" class="text-gray-100 hover:text-gray-200">Home</a>

        <!-- Separator (Normal direction for English) -->
        <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>

        <!-- Contact Us (English) -->
        <a href="{{ url('<front>') }}contact-us" class="text-green-400 hover:text-green-400">Contact Us</a>
      {% endif %}
    </div>

    <div class="relative w-full flex justify-center">
      <!-- Green card -->
      <div class="absolute top-0 right-8 md:right-0 w-[90%] xl:h-[100%] lg:h-[110%] md:h-[400px] sm:h-[350px] h-[400px] bg-[#32D2A0] -rotate-5 z-10"></div>

      <!-- White card -->
      <div
        class="relative bg-white contact-form-card rounded-2xl space-y-12 sm:space-y-16 md:space-y-20 -mb-32 md:-mb-40 shadow-md w-full p-6 sm:p-8 md:p-12 xl:pl-40 xl:pr-24 lg:py-40 py-10 z-10">

        <!-- Header Text -->
        <div class="mb-4 sm:mb-6">
          <h1 id="hero-heading" class="text-2xl md:text-3xl lg:text-4xl xl:text-[51px] mb-8 sm:mb-12 md:mb-16 lg:mb-20 leading-[1.1em] text-[#566578] font-bold" data-i18n="main.heading">
            {% if language.id == 'ar' %}
              هل لديك أي أسئلة؟ نحن هنا للإجابة عليها
            {% else %}
              Any questions? We are here to answer them!
            {% endif %}
          </h1>
        </div>

        <!-- Form (AJAX submission, no redirect) -->
        <form{{ contact_us_form.attributes.addClass(['space-y-6', 'contact-form']) }} 
          action="/contact/contact_us_form" 
          method="post" 
          id="contact-message-contact-us-form-form" 
          accept-charset="UTF-8"
        >
          {{ contact_us_form.form_build_id }}
          {{ contact_us_form.form_token }}
          {{ contact_us_form.form_id }}

          <div class="grid grid-cols-1 sm:grid-cols-2 input-fields-container lg:grid-cols-3 overflow-hidden gap-4 sm:gap-6">
            {% if language.id == 'ar' %}
              {{ contact_us_form.field_name|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'اسمك', 'aria-label': 'اسمك', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm']}}) }}
              {{ contact_us_form.field_email|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'عنوان البريد الإلكتروني', 'aria-label': 'عنوان البريد الإلكتروني', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm']}}) }}
              {{ contact_us_form.field_phone_number|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'رقم الهاتف (اختياري)', 'aria-label': 'رقم الهاتف (اختياري)', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm', 'sm:col-span-2', 'lg:col-span-1']}}) }}
            {% else %}
              {{ contact_us_form.field_name|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'Your Name', 'aria-label': 'Your Name', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm']}}) }}
              {{ contact_us_form.field_email|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'Email Address', 'aria-label': 'Email Address', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm']}}) }}
              {{ contact_us_form.field_phone_number|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'Phone Number (optional)', 'aria-label': 'Phone Number (optional)', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm', 'sm:col-span-2', 'lg:col-span-1']}}) }}
            {% endif %}
          </div>

          <div class="message-field-container">
            {% if language.id == 'ar' %}
              {{ contact_us_form.field_message|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'الرسالة', 'aria-label': 'الرسالة', 'rows': '3', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm']}}) }}
            {% else %}
              {{ contact_us_form.field_message|merge({'#title_display': 'invisible', '#attributes': {'placeholder': 'Message', 'aria-label': 'Message', 'rows': '3', 'class': ['border-b', 'w-full', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'placeholder:text-black', 'border-gray-300', 'focus:border-gray-600', 'pb-4', 'text-sm']}}) }}
            {% endif %}
          </div>

          <!-- Submit Button -->
          <div class="pt-4">
            {{ contact_us_form.actions.submit|merge({
              '#attributes': {
                'class': ['bg-[#32D2A0]', 'text-white', 'px-8', 'sm:px-12', 'py-3', 'sm:py-4', 'rounded-lg', 'shadow', 'text-sm', 'w-full', 'sm:w-auto', 'flex', 'items-center', 'justify-center', 'gap-2', 'contact-submit-btn', 'focus:outline-none', 'focus:ring-2', 'focus:ring-emerald-500', 'focus:ring-offset-2', 'hover:bg-[#2AB890]', 'transition-colors'],
                'aria-label': (language.id == 'ar') ? 'إرسال الرسالة' : 'Send message'
              },
              '#value': (language.id == 'ar') ? 'إرسال' : 'Send'
            }) }}
          </div>
        </form>

      </div>
    </div>
  </div>
</div>
<div style="padding-bottom:100px;"></div>

{# ========================== #
   Success Popup Modal (UI)
   ========================== #}
<div 
  id="contactSuccessModal"
  class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40 px-4"
  aria-hidden="true"
>
  <div
    class="relative w-full max-w-md mx-auto rounded-2xl bg-white shadow-xl overflow-hidden
    {% if language.id == 'ar' %} text-right {% endif %}"
    {% if language.id == 'ar' %} dir="rtl" {% endif %}
  >
    {# Top accent bar #}
    <div class="h-1 w-full bg-gradient-to-r from-[#009595] via-[#32D2A0] to-[#00D3B4]"></div>

    <div class="p-6 sm:p-8">
      {# Close button #}
      <button
        type="button"
        class="absolute top-3 {% if language.id == 'ar' %}left-3{% else %}right-3{% endif %} rounded-full p-1.5 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition"
        data-close-modal
        aria-label="{% if language.id == 'ar' %}إغلاق{% else %}Close{% endif %}"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M10 8.586L13.95 4.636L15.364 6.05L11.414 10L15.364 13.95L13.95 15.364L10 11.414L6.05 15.364L4.636 13.95L8.586 10L4.636 6.05L6.05 4.636L10 8.586Z" clip-rule="evenodd" />
        </svg>
      </button>

      {# Icon #}
      <div class="flex justify-center mb-4">
        <div class="flex items-center justify-center h-14 w-14 rounded-full bg-[#E6FFF7]">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-[#32D2A0]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 12l2 2 4-4M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
      </div>

      {# Title + Text #}
      <h2 class="text-xl sm:text-2xl font-semibold text-[#1F2933] mb-2 text-center">
        {% if language.id == 'ar' %}
          شكرًا لتواصلك معنا!
        {% else %}
          Thank you for your submission!
        {% endif %}
      </h2>

      <p class="text-sm sm:text-base text-gray-600 mb-6 text-center leading-relaxed">
        {% if language.id == 'ar' %}
          سيقوم فريقنا بالتواصل معك قريبًا.
        {% else %}
          Our team will contact you soon.
        {% endif %}
      </p>

      {# Buttons #}
      <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
        <button
          type="button"
          data-close-modal
          class="w-full inline-flex items-center justify-center rounded-xl border border-gray-200
                 px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition"
        >
          {% if language.id == 'ar' %}إغلاق{% else %}Close{% endif %}
        </button>

        <a
          href="{{ path('<front>') }}"
          class="w-full inline-flex items-center justify-center rounded-xl bg-[#32D2A0]
                 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-[#2AB38A] transition"
        >
          {% if language.id == 'ar' %}العودة إلى الرئيسية{% else %}Back to Home{% endif %}
        </a>
      </div>
    </div>
  </div>
</div>

{# ========================== #
   Script: AJAX submit + modal
   ========================== #}
<script>
  (function () {
    var form = document.getElementById('contact-message-contact-us-form-form');
    var modal = document.getElementById('contactSuccessModal');
    if (!form || !modal) return;

    var closeButtons = modal.querySelectorAll('[data-close-modal]');
    var submitBtn = form.querySelector('.contact-submit-btn');
    var originalBtnText = submitBtn ? (submitBtn.value || submitBtn.innerText) : '';

    function openModal() {
      modal.classList.remove('hidden');
      modal.classList.add('flex'); // so items-center/justify-center work
      document.body.classList.add('overflow-hidden');
    }

    function closeModal() {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      document.body.classList.remove('overflow-hidden');
    }

    closeButtons.forEach(function (btn) {
      btn.addEventListener('click', closeModal);
    });

    // Close on backdrop click
    modal.addEventListener('click', function (e) {
      if (e.target === modal) {
        closeModal();
      }
    });

    // Handle AJAX submit
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      if (submitBtn) {
        submitBtn.disabled = true;
        if (submitBtn.tagName.toLowerCase() === 'input') {
          submitBtn.value = '{% if language.id == "ar" %}جارٍ الإرسال...{% else %}Sending...{% endif %}';
        } else {
          submitBtn.innerText = '{% if language.id == "ar" %}جارٍ الإرسال...{% else %}Sending...{% endif %}';
        }
      }

      var formData = new FormData(form);

      fetch(form.action, {
        method: 'POST',
        body: formData,
        credentials: 'same-origin'
      })
      .then(function (response) {
        // Even if Drupal responds with a redirect, fetch follows it.
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        // Reset the form and show success modal
        form.reset();
        openModal();
      })
      .catch(function (error) {
        console.error('Form submission error:', error);
        alert('{% if language.id == "ar" %}حدث خطأ أثناء إرسال النموذج. يرجى المحاولة مرة أخرى.{% else %}There was an error submitting the form. Please try again.{% endif %}');
      })
      .finally(function () {
        if (submitBtn) {
          submitBtn.disabled = false;
          if (submitBtn.tagName.toLowerCase() === 'input') {
            submitBtn.value = originalBtnText;
          } else {
            submitBtn.innerText = originalBtnText;
          }
        }
      });
    });
  })();
</script>

{% include '@acp/footer.html.twig' %}
