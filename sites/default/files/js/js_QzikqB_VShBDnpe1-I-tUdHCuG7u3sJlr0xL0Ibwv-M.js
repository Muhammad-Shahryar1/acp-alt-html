// Initialize i18next
i18next.init(
  {
    lng: "en", // default language
    resources: {
      en: {
        translation: {
          // Navigation
          "nav.about": "About",
          "nav.routes": "Routes",
          "nav.saudiDestinations": "Saudi Destinations",
          "nav.mediaCenter": "Media Center",
          "nav.contactUs": "Contact Us",
          "nav.visitSaudi": "Visit Saudi",
          "nav.becomePartner": "Become a Partner",

          // Hero Section
          "hero.connectingWorld": "Connecting the World",
          "hero.toSaudiArabia": "to Saudi Arabia",

          // Content Section
          "content.discoverKingdom":
            "Discover the Kingdom's exciting air connectivity opportunities and remarkable new tourism growth.",

          // Buttons
          "buttons.becomePartner": "Become a Partner",
          "buttons.exploreRoutes": "Explore Routes",
          "buttons.readMore": "Read More",

          //Airports
          "airports.kingKhalidInternationalAirport":
            "King Khalid International Airport",
          "airports.kingAbdulazizInternationalAirport":
            "King Abdulaziz International Airport",
          "airports.kingFahdInternationalAirport":
            "King Fahd International Airport",

          // Sections
          "sections.airConnectivityProgram": "Air Connectivity Program",
          "sections.programDescription":
            "Aims to boost tourism growth in the Kingdom by enhancing air connectivity and developing existing and potential air routes to connect Saudi Arabia with new global destinations. Acting as the executive enabler of the National Tourism Strategy and the Aviation Program, the ACP fosters collaboration and builds partnerships between key public and private stakeholders in tourism and aviation to strengthen the Kingdom's position as a leading global destination for air connectivity.",
          "sections.kingdomAirports": "Kingdom Airports",
          "sections.routes": "Routes",
          "sections.routesDescription":
            "Discover routes linking Saudi airports to global destinations.",
          "sections.chooseContinent": "Choose A Continent",
          "sections.news": "News",
          "sections.saudiAirConnectivity":
            "The Saudi Air Connectivity Partners",
          "sections.partnersDescription":
            "Working with key aviation and tourism leaders to expand connectivity.",

          // Statistics
          "stats.drivingGlobalConnections": "DRIVING GLOBAL CONNECTIONS",
          "stats.saudiAirConnectivity": "The Saudi Air Connectivity",
          "stats.vision2030Initiative":
            "A Vision 2030 initiative expanding routes and global connectivity.",
          "stats.routesActivated": "Routes Activated",
          "stats.routesActivatedDigit": "67",
          "stats.routesActivatedDesc": "Activated Routes in 2024 YTD",
          "stats.carrierCollaboration": "Carrier Collaboration",
          "stats.carrierCollaborationDigit": "15",
          "stats.carrierCollaborationDesc": "Carriers in 2024 YTD",
          "stats.seatsGenerated": "Seats Generated",
          "stats.seatsGeneratedDigit": "4.5",
          "stats.seatsGeneratedDesc":
            "4,5 million generated seats in 2024 YTD.",
          "stats.airlines": "Airlines",
          "stats.airlinesDigit": "5",
          "stats.airlinesDesc":
            "Strategic Partnerships With Local and International Carriers",

          // Search
          "search.saudiAirportsPlaceholder": "Saudi Arabia airports...",
          "search.searchAirports": "Search Saudi Arabia Airports ...",
          "search.noAirportsFound": "No airports found",
          "search.King Khalid International Airport":
            "King Khalid International Airport",
          "search.King Abdulaziz International Airport":
            "King Abdulaziz International Airport",
          "search.King Fahd International Airport":
            "King Fahd International Airport",
          "search.Prince Mohammad bin Abdulaziz International Airport":
            "Prince Mohammad bin Abdulaziz International Airport",
          "search.Taif International Airport": "Taif International Airport",
          "search.Abha International Airport": "Abha International Airport",
          "search.Hail International Airport": "Hail International Airport",
          "search.King Abdullah Bin Abdulaziz International Airport":
            "King Abdullah Bin Abdulaziz International Airport",
          "search.Prince Sultan bin Abdulaziz International Airport":
            "Prince Sultan bin Abdulaziz International Airport",
          "search.Prince Naif bin Abdulaziz International Airport":
            "Prince Naif bin Abdulaziz International Airport",
          "search.Prince Abdul Mohsin Bin Abdulaziz International Airport":
            "Prince Abdul Mohsin Bin Abdulaziz International Airport",
          "search.Al-Jouf International Airport":
            "Al-Jouf International Airport",
          "search.Al-Ahsa International Airport":
            "Al-Ahsa International Airport",
          "search.Qaisumah International Airport":
            "Qaisumah International Airport",
          "search.Al-Ula International Airport": "Al-Ula International Airport",
          "search.Najran International Airport": "Najran International Airport",
          "search.Arar International Airport": "Arar International Airport",
          "search.Red Sea Airport": "Red Sea Airport",
          "search.Neom Bay Airport": "Neom Bay Airport",
          "search.King Saud Bin Abdulaziz Airport":
            "King Saud Bin Abdulaziz Airport",
          "search.Bisha Airport": "Bisha Airport",
          "search.Dawadmi Airport": "Dawadmi Airport",
          "search.Al-Wajh Airport": "Al-Wajh Airport",
          "search.Qurayyat Airport": "Qurayyat Airport",
          "search.Rafah Airport": "Rafah Airport",
          "search.Rabigh Airport": "Rabigh Airport",
          "search.Sharurah Airport": "Sharurah Airport",
          "search.Turaif Airport": "Turaif Airport",
          "search.Wadi Al Dawasir Airport": "Wadi Al Dawasir Airport",

          // Flights
          "flights.airline": "Airline",
          "flights.started": "Started?",
          "flights.startedYes": "Yes",
          "flights.startedNo": "No",
          "flights.yearStarted": "Year Started",

          // Continents
          "continent.asia": "Asia",
          "continent.europe": "Europe",
          "continent.africa": "Africa",
          "continent.north america": "North America",
          "continent.south america": "South America",
          "continent.australia": "Australia",

          // ARTICLES ENGLISH
          "articles.featured.1.title":
            "Flights between Abha and Doha Resumed, First Aircraft Landed at Abha International Airport",
          "articles.featured.1.description":
            "The Air Connectivity Program (ACP) has thanked Qatar Airways for the resumption of direct flights between Doha and Abha in collaboration with Discover Aseer and Abha International Airport. The Air Connectivity Program, in cooperation with its partners Discover Aseer, Abha International Airport, the Saudi Tourism Authority, and Qatar Airways, celebrated the resumption of direct flights",
          "articles.featured.2.title":
            "Air Connectivity Program Welcomes Lufthansa's New Direct Munich to Riyadh Flights",
          "articles.featured.2.description":
            "The Saudi Air Connectivity Program (ACP) has welcomed Lufthansa’s launch of direct flights from Munich to Riyadh, with three weekly flights set to begin on October 27 of this year. The new route is an important addition to the existing daily flights between Riyadh and Frankfurt, offering travelers more options to fly from Germany to Saudi Arabia. It will contribute to the development of air connectivity and increase seat capacity.",
          "articles.featured.3.title":
            "China Southern Airlines Launches New Route between Guangzhou, Riyadh",
          "articles.featured.3.description":
            "China Southern Airlines, in cooperation with the Air Connectivity Program, the Saudi Tourism Authority, and Riyadh Airports Company, has announced the launch of a new flight route between Guangzhou in China and Riyadh, starting in September 2025. The route will operate three times per week, adding over 86,000 seats annually to this route.",
          "articles.featured.4.title":
            "King Abdulaziz International Airport Launches First Hainan Airlines Flights",
          "articles.featured.4.description":
            "King Abdulaziz International Airport in Jeddah today welcomed the inaugural flight of China’s Hainan Airlines, marking the launch of the first direct route between Jeddah and the Chinese city of Haikou. The new service will operate three times per week, positioning the airport as the first in the Kingdom to offer direct connectivity to Haikou.The launch of this route boosts air traffic between Saudi Arabia.",
          "articles.featured.5.title":
            "Riyadh Welcomes First Virgin Atlantic Heathrow Flight, Boosting Global Tourism Status",
          "articles.featured.5.description":
            "King Khalid International Airport today welcomed the inaugural flight of British airline Virgin Atlantic, arriving from London Heathrow and carrying the company's founder, Richard Branson.The new daily route supports Saudi Vision 2030's ambitious tourism plans and reflects the growing ties between Saudi Arabia and the UK, expecting a rise in air travel.Minister of Tourism and Saudi Tourism Authority Chairman of the Board of Directors Ahmed Al-Khateeb",
          "articles.featured.6.title":
            "Air Connectivity Program, MDA Partner with Transavia France to Launch New Flight Routes to Madinah.",
          "articles.featured.6.description":
            "The Air Connectivity Program (ACP), in partnership with the Al Madinah Region Development Authority (MDA), has announced the expansion of Transavia France's travel services to Saudi Arabia. Beginning in October, new routes will be launched from Paris-Orly, Lyon, Marseille, and Toulouse to Madinah.This expansion complements the successful launch last year of routes connecting Paris-Orly and Lyon with Jeddah, enhancing.",
          "articles.featured.7.title":
            "Saudi Air Connectivity Program Launches Direct Flights from Stuttgart to Jeddah",
          "articles.featured.7.description":
            "The Saudi Air Connectivity Program (ACP), in collaboration with the Saudi Tourism Authority (STA) and Jeddah Airports Company (JEDCO), announced on Tuesday the launch of direct flights from Stuttgart, Germany, to Jeddah.The flights will commence in the second half of 2025, operating twice a week using an A321neo aircraft with a capacity of 224 seats. This initiative aims to increase capacity for travelers and visitors.",

          "articles.featured.1.date": "02 January 2025",
          "articles.featured.2.date": "19 August 2025",
          "articles.featured.3.date": "17 July 2025",
          "articles.featured.4.date": "28 July 2025",
          "articles.featured.5.date": "23 April 2025",
          "articles.featured.6.date": "17 April 2025",
          "articles.featured.7.date": "05 March 2025",

          // Footer
          "footer.overview": "Overview",
          "footer.brief": "Brief",
          "footer.ourPartners": "Our Partners",
          "footer.becomePartner": "Become a Partner",
          "footer.contactSupport": "Contact and Support",
          "footer.contactUs": "Contact us",
          "footer.mediaCenter": "Media Center",
          "footer.privacyTerms": "Privacy and Terms of Use",
          "footer.relatedLinks": "Related Links",
          "footer.vision2030": "Vision 2030",
          "footer.ministryTourism": "Ministry of Tourism",
          "footer.gaca": "GACA",
          "footer.saudiTourismAuthority": "Saudi Tourism Authority",
          "footer.tdf": "TDF",
          "footer.redSea": "Red Sea Authority",
          "footer.followUs": "Follow us on",
          "footer.address":
            "2nd Floor, Building 6 GACA Complex, Riyadh 12512, Saudi",
          "footer.copyright":
            "Copyright © 2025 Air Connectivity Program. All rights reserved.",
        },
      },
      ar: {
        translation: {
          // Navigation
          "nav.about": "حول البرنامج",
          "nav.routes": "المسارات",
          "nav.mediaCenter": "المركز الإعلامي",
          "nav.contactUs": "تواصل معنا",
          "nav.visitSaudi": "زوروا السعودية",
          "nav.becomePartner": "كن شريكاً",

          // Hero Section
          "hero.connectingWorld": "نربط العالم بالمملكة",
          "hero.toSaudiArabia": "العربية السعودية",

          // Content Section
          "content.discoverKingdom":
            "اكتشف فرص الربط الجوي الواعدة وآفاق النمو السياحي في المملكة‌‌",

          // Buttons
          "buttons.becomePartner": "كن شريكاً",
          "buttons.exploreRoutes": "اكتشف المسارات",
          "buttons.readMore": "اقرأ المزيد",

          // Sections
          "sections.airConnectivityProgram": "برنامج الربط الجوي",
          "sections.programDescription":
            "برنامج الربط الجوي هو برنامج يستهدف زيادة النمو السياحي في المملكة، من خلال تعزيز الربط الجوي بين المملكة ودول العالم، عبر تطوير المسارات الجوية الحالية والمحتملة، وربط المملكة بوجهاتٍ جديدة عالمية، ويعمل برنامج الربط الجوي بصفته المُمكّن التنفيذي للإستراتيجية الوطنية للسياحة، وبرنامج الطيران، على تعزيز التعاون وبناء الشراكات بين الجهات الفاعلة الرئيسية في القطاعين العام والخاص في منظومتيّ السياحة والطيران، لتعزيز مكانة المملكة بصفتها وجهة سياحية رائدة عالميًا في مجال الربط الجوي السياحي.",
          "sections.kingdomAirports": "مطارات المملكة",
          "sections.routes": "المسارات",
          "sections.routesDescription":
            "اكتشف المسارات التي تربط مطارات المملكًة بالوجهات",
          "sections.chooseContinent": "اختر قارة",
          "sections.news": "الاخبار",
          "sections.saudiAirConnectivity": " شركاء برنامج الربط الجوي",
          "sections.partnersDescription":
            "العمل مع قادة قطاعي الطيران والسياحة لتوسيع نطاق الربط الجوي",

          // Statistics
          "stats.drivingGlobalConnections": "قيادة المسارات العالمية",
          "stats.saudiAirConnectivity": "برنامج الربط الجوي السعودي",
          "stats.vision2030Initiative":
            "مبادرة ضمن رؤية ٢٠٣٠ لتوسيع مسارات الطيران وتعزيز الربط الجوي",
          "stats.routesActivated": "المسارات المفعلة",
          "stats.routesActivatedDigit": "٦٧",
          "stats.routesActivatedDesc":
            "المسارات المفعلة في عام ٢٠٢٤ حتى تاريخه",
          "stats.carrierCollaboration": "التعاون مع الناقلين",
          "stats.carrierCollaborationDigit": "١٥",
          "stats.carrierCollaborationDesc": "الناقلون في عام ٢٠٢٤ حتى تاريخه",
          "stats.seatsGenerated": "المقاعد التي تم توفيرها",
          "stats.seatsGeneratedDigit": "٤.٥",
          "stats.seatsGeneratedDesc":
            "٤.٥ مليون مقعد تم تقديمه في عام ٢٠٢٤ حتى تاريخه",
          "stats.airlines": "شركات الطيران",
          "stats.airlinesDigit": "٥",
          "stats.airlinesDesc": "شراكات استراتيجية مع شركات طيران محلية ودولية",

          // Search
          "search.saudiAirportsPlaceholder":
            "مطارات المملكة العربية السعودية...",
          "search.searchAirports":
            "ابحث عن مطارات المملكة العربية السعودية ...",
          "search.noAirportsFound": "لم يتم العثور على مطارات",
          "search.King Khalid International Airport": "مطار الملك خالد الدولي",
          "search.King Abdulaziz International Airport":
            "مطار الملك عبد العزيز الدولي",
          "search.King Fahd International Airport": "مطار الملك فهد الدولي",
          "search.Prince Mohammad bin Abdulaziz International Airport":
            "مطار الأمير محمد بن عبدالعزيز الدولي",
          "search.Taif International Airport": "مطار الطائف الدولي",
          "search.Abha International Airport": "مطار أبها الدولي",
          "search.Hail International Airport": "مطار حائل الدولي",
          "search.King Abdullah Bin Abdulaziz International Airport":
            "مطار الملك عبدالله بن عبدالعزيز الدولي",
          "search.Prince Sultan bin Abdulaziz International Airport":
            "مطار الأمير سلطان بن عبدالعزيز الدولي",
          "search.Prince Naif bin Abdulaziz International Airport":
            "مطار الأمير نايف بن عبدالعزيز الدولي",
          "search.Prince Abdul Mohsin Bin Abdulaziz International Airport":
            "مطار الأمير عبدالمحسن بن عبدالعزيز الدولي",
          "search.Al-Jouf International Airport": "مطار الجوف الدولي",
          "search.Al-Ahsa International Airport": "مطار الأحساء الدولي",
          "search.Qaisumah International Airport": "مطار القيصومة الدولي",
          "search.Al-Ula International Airport": "مطار العلا الدولي",
          "search.Najran International Airport": "مطار نجران الدولي",
          "search.Arar International Airport": "مطار عرعر الدولي",
          "search.Red Sea Airport": "مطار البحر الأحمر",
          "search.Neom Bay Airport": "مطار خليج نيوم",
          "search.King Saud Bin Abdulaziz Airport":
            "مطار الملك سعود بن عبدالعزيز",
          "search.Bisha Airport": "مطار بيشة",
          "search.Dawadmi Airport": "مطار الدوادمي",
          "search.Al-Wajh Airport": "مطار الوجه",
          "search.Qurayyat Airport": "مطار القريات",
          "search.Rafah Airport": "مطار رفحاء",
          "search.Rabigh Airport": "مطار رابغ",
          "search.Sharurah Airport": "مطار شرورة",
          "search.Turaif Airport": "مطار طريف",
          "search.Wadi Al Dawasir Airport": "مطار وادي الدواسر",

          // Flights
          "flights.airline": " التشغيل؟",
          "flights.started": "هل بدأ",
          "flights.startedYes": "نعم",
          "flights.startedNo": "لا",
          "flights.yearStarted": "سنة التشغيل",
          // "flights.airline": "الخطوط الجوية",
          // "flights.started": "بدأت؟",
          // "flights.yearStarted": "سنة البداية",

          // Continents
          "continent.asia": "آسيا",
          "continent.europe": "أوروبا",
          "continent.africa": "أفريقيا",
          "continent.north america": "أمريكا الشمالية",
          "continent.south america": "أمريكا الجنوبية",
          "continent.australia": "أستراليا",

          "articles.featured.1.title":
            "استئناف الرحلات بين أبها والدوحة مع هبوط أول طائرة في مطار أبها الدولي",
          "articles.featured.1.description":
            "رحب برنامج الربط الجوي (ACP) بشركة الخطوط الجوية القطرية لاستئناف الرحلات المباشرة بين الدوحة وأبها، بالتعاون مع اكتشف عسير ومطار أبها الدولي واحتفل برنامج الربط الجوي بالتعاون مع شركائه اكتشف عسير، ومطار أبها الدولي، والهيئة السعودية للسياحة، والخطوط الجوية القطرية، باستئناف الرحلات المباشرة بين الدوحة وأبها ويعد هذا الإنجاز خطوة مهمة ضمن إستراتيجية الطيران الوطنية للمملكة لعام 2024 ربط العالم بالمملكة، التي تهدف إلى زيادة عدد المسافرين إلى 330 مليون",
          "articles.featured.2.title":
            "برنامج الربط الجوي يرحب بخطوط لوفتهانزا لتسيير رحلات مباشرة من ميونخ إلى الرياض.",
          "articles.featured.2.description":
            "رحب برنامج الربط الجوي بتسيير خطوط لوفتهانزا الألمانية لرحلاتها المباشرة من مدينة ميونخ إلى مدينة الرياض، بمعدل ثلاث رحلات أسبوعيًا اعتبارًا من 27 أكتوبر من العام الجاري، مما يسهم في تطوير المسارات الجوية وزيادة السعة المقعدية، ويعد هذا المسار الجوي الجديد إضافة مهمة إلى الرحلات اليومية الحالية بين الرياض وفرانكفورت، حيث يوفر للسائحين خيارات أوسع للسفر من ألمانيا إلى المملكة، ومن المقرر أن تُشغّل لوفتهانزا هذا الخط المُعاد إطلاقه باستخدام أحدث طائراتها، طراز (إيرباص A350-900) بسعة 293 مقعدًا موزعة على درجة الأع..",
          "articles.featured.3.title":
            "بالتعاون مع برنامج الربط الجوي والهيئة السعودية للسياحة ومطارات ..خطوط جنوب الرياض الصين الجوية تطلق مسارًا جديدًا بين مدينتي الرياض وجوانزو.",
          "articles.featured.3.description":
            "أعلنت خطوط جنوب الصين الجوية، بالتعاون مع برنامج الربط الجوي والهيئة السعودية للسياحة ومطارات الرياض، عن إطلاق مسار رحلات جديد بين مدينة جوانزو بجمهورية الصين الشعبية ومدينة الرياض، وسيبدأ تشغيل المسار الجديد بداية من شهر سبتمبر 2025 وبمعدل ثلاث رحلات أسبوعيًا؛ مما يضيف أكثر من 86 ألف مقعد سنوي لهذا المسار، ويأتي هذا التوسع في أعقاب الطلب المتزايد على الرحلات بين المملكة العربية السعودية وجمهورية الصين الشعبية، والنجاح اللافت الذي حققته الرحلات المباشرة بين العاصمة الرياض ومدينة شنجن، التي..",
          "articles.featured.4.title":
            "مطار الملك عبدالعزيز الدولي يدشّن أولى رحلات طيران هاينان الصينية.",
          "articles.featured.4.description":
            "استقبل مطار الملك عبدالعزيز الدولي بجدة اليوم أولى الرحلات الجوية لشركة طيران هاينان الصينية، كأول مطار في المملكة يقوم بتسيير رحلات جوية مباشرة إلى مدينة هايكو الصينية بواقع ثلاث رحلات أسبوعيًا، وتعزز هذه الوجهة الجديدة بين المدينتين الحركة الجوية النامية، مما يرسخ مكانة المطار كمركز لوجستي عالمي، ويضيف ربطًا جويًا مباشرًا بين المملكة والصين، واستقبل الرحلة الرئيس التنفيذي لشركة مطارات جدة المهندس مازن بن محمد جوهر، والقنصل العام لجمهورية الصين الشعبية بجدة وانغ تشي، وعدد من قيادات هيئة السياحة وبرنام.",
          "articles.featured.5.title":
            "الرياض ترسخ مكانتها وجهة سياحية عالمية وتستقبل أولى رحلات فيرجن أتلانتيك من مطار هيثرو الدولي.",
          "articles.featured.5.description":
            "استقبل مطار الملك خالد الدولي أولى رحلات شركة الطيران البريطانية فيرجن أتلانتيك، القادمة من مطار هيثرو في لندن عبر الرحلة رقم VS242، وكان على متن طائرة الإيرباص A330neo مؤسس الشركة السير ريتشارد برانسون، ويأتي إطلاق هذا المسار اليومي في إطار خطط النمو الطموحة لرؤية المملكة 2030، وتنامي دور المملكة وجهة سياحية عالمية رائدة، كما يعكس قوة العلاقات المتنامية بين البلدين، والنمو المتوقع في حركة السفر الجوي بين السعودية والمملكة المتحدة، وتشهد الرياض تطورات متسارعة تجعلها وجهة جاذبة للاستثمار والسياحة، كما تعد نقطة انطلاق مثالية لاستكشاف الثرا.",
          "articles.featured.6.title":
            "برنامج الربط الجوي وهيئة تطوير منطقة المدينة المنورة يتعاونان مع خطوط ترانسافيا فرنسا لتوسيع شبكة رحلاتها إلى المدينة المنورة.",
          "articles.featured.6.description":
            "أعلن برنامج الربط الجوي (ACP) بالشراكة مع هيئة تطوير منطقة المدينة المنورة عن توسيع عمليات خطوط ترانسافيا فرنسا في السوق السعودي ابتداءً من أكتوبر 2025، من خلال إطلاق وجهات جديدة من باريس أورلي، ليون، مارسيليا، وتولوز إلى المدينة المنورة، ويأتي هذا التوسع استكمالًا لإطلاق الوجهات الناجحة العام الماضي بين باريس أورلي وليون إلى جدة، مما يعزز الربط الجوي ويعكس النمو المتزايد في الطلب على السفر بين البلدين، ويؤكد مكانة المملكة وجهة رئيسية، ويدعم كذلك الأهداف السياحية لرؤية المملكة 2030، من خلال زيادة أعداد السياح القادمين إلى المملكة وتعزيز مكانتها وجهة سياحي.",
          "articles.featured.7.title":
            "برنامج الربط الجوي يطلق رحلات مباشرة من مدينة شتوتغارت الألمانية إلى مدينة جدة.",
          "articles.featured.7.description":
            "أطلق برنامج الربط الجوي اليوم بالتعاون مع الهيئة السعودية للسياحة وشركة مطارات جدة، رحلات مباشرة من مدينة شتوتغارت الألمانية إلى مدينة جدة التاريخية، وستبدأ الرحلات خلال النصف الثاني من العام الجاري 2025م، بواقع رحلتين أسبوعيًا، وذلك بواسطة أسطول من طائرة A321neo بسعة 224 مقعدًا ما يسهم في زيادة السعة المقعدية للقادمين والزوار إلى المملكة من دول أوروبا وأمريكا، وأوضح المدير التنفيذي لبرنامج الربط الجوي ماجد خان بهذه المناسبة أن التعاون مع خطوط يورو وينغز يشهد تقدمًا كبيرًا في الربط الجوي بين المملكة وأوروبا، متطلعًا إلى بناء شراكة طويلة الأجل مع يورو وينغز لتوسيع شب.",

          "articles.featured.1.date": "٠٢ يناير ٢٠٢٥",
          "articles.featured.2.date": "١٩ أغسطس ٢٠٢٥",
          "articles.featured.3.date": "١٧ يوليو ٢٠٢٥",
          "articles.featured.4.date": "٢٨ يوليو ٢٠٢٥",
          "articles.featured.5.date": "٢٣ أبريل ٢٠٢٥",
          "articles.featured.6.date": "١٧ أبريل ٢٠٢٥",
          "articles.featured.7.date": "٠٥ مارس ٢٠٢٥",

          // Footer
          "footer.overview": "لمحة عامة",
          "footer.brief": "نبذة",
          "footer.ourPartners": "شركاؤنا",
          "footer.becomePartner": "كن شريكاً",
          "footer.contactSupport": "لتواصل والدعم",
          "footer.contactUs": "اتصل بنا",
          "footer.mediaCenter": "المركز الإعلامي",
          "footer.privacyTerms": "الخصوصية وشروط الاستخدام",
          "footer.relatedLinks": "روابط ذات صلة",
          "footer.vision2030": "رؤية٢٠٣٠",
          "footer.ministryTourism": "وزارة السياحة",
          "footer.gaca": "هيئة الطيران المدني",
          "footer.saudiTourismAuthority": "الهيئة السعودية للسياحة",
          "footer.tdf": "صندوق التنمية السياحية",
          "footer.redSea": "الهيئة السعودية للبحر الأحمر",
          "footer.followUs": "تابعنا على",
          "footer.address":
            "الطابق الثاني، المبنى ٦ مجمع هيئة الطيران المدني، الرياض، ١٢٥١٩ السعودية",
          "footer.copyright": "جميع الحقوق محفوظة برنامج الربط الجوي 2025",
        },
      },
    },
  },
  function (err, t) {
    // Initialize translation
    updateContent();
  }
);

function selectLanguage(lang) {
  const dropdown = document.getElementById("language-dropdown");
  const currentFlag = document.getElementById("current-flag");
  const currentLang = document.getElementById("current-lang");

  if (lang === "ar") {
    currentFlag.textContent = "🇸🇦";
    currentLang.textContent = "AR";
  } else {
    currentFlag.textContent = "🇺🇸";
    currentLang.textContent = "EN";
  }

  dropdown.classList.add("hidden");

  // Call existing language change function
  if (typeof setLanguage === "function") {
    setLanguage(lang);
  }
}

// Change language and refresh UI
function setLanguage(lang) {
  // Save language to localStorage
  // localStorage.setItem("appLanguage", lang);

  // Apply lang & direction
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";

  // Hero Panel Container
  document
    .querySelector("#panel-container")
    .classList.add(lang === "ar" ? "right-[1%]" : "left-[5%]");
  document
    .querySelector("#panel-container")
    .classList.remove(lang === "ar" ? "left-[5%]" : "right-[1%]");

  // Animated GSAP Text
  document.querySelector("#gsap-text").dir = lang === "ar" ? "rtl" : "ltr";

  // General Pagination
  // document.querySelector("#flightsPaginationSlider").dir =
  //   lang === "ar" ? "ltr" : "ltr";
  document.querySelector("#continentPaginationSlider").dir =
    lang === "ar" ? "ltr" : "ltr";

  document.querySelector("#newspaginationslider").dir =
    lang === "ar" ? "rtl" : "ltr";

  // Routes Navigation
  const routeNextBtn = document.getElementById("flight-next-page");
  const routePrevBtn = document.getElementById("flight-prev-page");
  routePrevBtn.classList.add(lang === "ar" ? "!rotate-180" : "rotate-0");
  routePrevBtn.classList.remove(lang === "ar" ? "!rotate-0" : "!rotate-180");
  routeNextBtn.classList.add(lang === "ar" ? "!rotate-180" : "!rotate-0");
  routeNextBtn.classList.remove(lang === "ar" ? "!rotate-0" : "!rotate-180");

  // News Slider
  document.querySelector("#sliderNewsSection").dir =
    lang === "ar" ? "RTL" : "ltr";
  // News Slider Navigation
  // Update button states
  const prevBtn = document.getElementById("news-prev");
  const nextBtn = document.getElementById("news-next");
  prevBtn.classList.add(lang === "ar" ? "!rotate-180" : "rotate-0");
  prevBtn.classList.remove(lang === "ar" ? "!rotate-0" : "!rotate-180");
  nextBtn.classList.add(lang === "ar" ? "!rotate-180" : "!rotate-0");
  nextBtn.classList.remove(lang === "ar" ? "!rotate-0" : "!rotate-180");
  // Infinite Slider
  document.querySelector("#infiniteImagesSlider").dir =
    lang === "ar" ? "ltr" : "ltr";

  // Toggle text alignment classes
  document.body.classList.add(lang === "ar" ? "!text-right" : "!text-left");
  document.body.classList.remove(lang === "ar" ? "!text-left" : "!text-right");
  // renderNewsSlider()
  slideNews();

  // Change i18next language
  i18next.changeLanguage(lang, function (err, t) {
    updateContent();
  });
}

document.addEventListener("DOMContentLoaded", () => {
  const savedLang = localStorage.getItem("appLanguage") || "en"; // fallback to English
  setLanguage(savedLang);
});

// Auto update all tags with [data-i18n]
function updateContent() {
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    el.innerHTML = i18next.t(key);
  });
  //

  // Update placeholders
  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    el.placeholder = i18next.t(key);
  });

  // Update flight search input placeholder specifically
  const flightSearchInput = document.getElementById("flight-search");
  if (flightSearchInput) {
    flightSearchInput.placeholder = i18next.t("search.searchAirports");
    i18next.reloadResources().then(() => {
      document.querySelectorAll("[data-i18n]").forEach((el) => {
        el.textContent = i18next.t(el.dataset.i18n);
      });
    });
  }

  // Update airport dropdown options
  updateAirportDropdown();
}

// Update airport dropdown with translations
function updateAirportDropdown() {
  // Update flight search results if they exist
  const flightSearchResults = document.getElementById("flight-search-results");
  if (flightSearchResults) {
    const resultItems = flightSearchResults.querySelectorAll("[data-i18n]");
    resultItems.forEach((item) => {
      const key = item.getAttribute("data-i18n");
      if (key) {
        item.textContent = i18next.t(key);
      }
    });
  }

  // Update flight cards if they exist
  const flightCardsGrid = document.getElementById("flight-cards-grid");
  if (flightCardsGrid) {
    const flightCards = flightCardsGrid.querySelectorAll("[data-i18n]");
    flightCards.forEach((card) => {
      const key = card.getAttribute("data-i18n");
      if (key) {
        card.textContent = i18next.t(key);
      }
    });
  }
}

// Language selector click handler
document.addEventListener("DOMContentLoaded", function () {
  const languageSelectors = document.querySelectorAll("#language-selector");
  languageSelectors.forEach((selector) => {
    selector.addEventListener("click", function () {
      const currentLang = i18next.language;
      const languageSelectorContentDesktop = document.getElementById(
        "language-selector-content-desktop"
      );
      const languageSelectorContentMobile = document.getElementById(
        "language-selector-content-mobile"
      );
      const newLang = currentLang === "en" ? "ar" : "en";
      newLang === "ar"
        ? (languageSelectorContentDesktop.innerHTML = "English")
        : (languageSelectorContentDesktop.innerHTML = "العربية");
      newLang === "ar"
        ? (languageSelectorContentMobile.innerHTML = "English")
        : (languageSelectorContentMobile.innerHTML = "العربية");

      // Save language to localStorage
      localStorage.setItem("appLanguage", newLang);
      setLanguage(newLang);
    });
  });
});

// navbar animation
window.addEventListener("scroll", function () {
  const header = document.getElementById("main-header");
  if (window.scrollY > 250) {
    header.classList.add("bg-white", "shadow-md", "text-gray-900");
    header.classList.remove("bg-transparent", "text-white");
    document.getElementById("mobile-menu").classList.add("!text-white");
  } else {
    header.classList.add("bg-transparent", "text-white");
    header.classList.remove("bg-white", "shadow-md", "text-gray-900");
  }
});

// Mobile menu toggle
const mobileMenuButton = document.getElementById("mobile-menu-button");
const mobileMenu = document.getElementById("mobile-menu");

if (mobileMenuButton && mobileMenu) {
  mobileMenuButton.addEventListener("click", function () {
    mobileMenu.classList.toggle("hidden");
  });
}

// Hide mobile menu when a link inside is clicked
if (mobileMenu) {
  const mobileLinks = mobileMenu.querySelectorAll("a");
  mobileLinks.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu.classList.add("hidden");
    });
  });
  document
    .querySelectorAll("#language-selector")[1]
    .addEventListener("click", (e) => {
      console.log("clicked lanf");
      mobileMenu.classList.add("hidden");
    });
}

function selectableStatsCards() {
  const cards = document.querySelectorAll(".stats-card > div"); // all 4 cards

  cards.forEach((card) => {
    card.addEventListener("click", () => {
      // Remove selected from all
      cards.forEach((c) => c.classList.remove("card-selected"));
      // Add to clicked one
      card.classList.add("card-selected");
    });
  });
}

document.addEventListener("DOMContentLoaded", () => {
  const saudiAirports = [
    {
      name: "King Khalid International Airport",
      city: "Riyadh",
      code: "RUH",
      images: [
        // "./assets/Riyadh-Airport/Riyadh-Airport/Image.jpg",
        // "./assets/Riyadh-Airport/Riyadh-Airport/riyadh-airport-2.jpg",
        // "./assets/Riyadh-Airport/Riyadh-Airport/2.jpeg",
        // "./assets/Riyadh-Airport/Riyadh-Airport/3.png",
        "./assets/Mataratpictures/Riyadh.jpg",
      ],
      temp: "28°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 16463.3,
          "International Passengers": 15490.7,
        },
        2024: {
          "Domestic Passengers": 19468.1,
          "International Passengers": 18107,
        },
      },
    },
    {
      name: "King Abdulaziz International Airport",
      city: "Jeddah",
      code: "JED",
      images: [
        // "./assets/JEDDAH/JEDDAH/bg-2-b.jpg",
        // "./assets/JEDDAH/JEDDAH/images.jpeg",
        // "./assets/JEDDAH/JEDDAH/images%20(1).jpeg",
        // "./assets/JEDDAH/JEDDAH/images4.jpeg",
        "./assets/Mataratpictures/Jeddah.jpg",
      ],
      temp: "32°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 13537.6,
          "International Passengers": 29479.1,
        },
        2024: {
          "Domestic Passengers": 15494.9,
          "International Passengers": 33575.1,
        },
      },
    },
    {
      name: "King Fahd International Airport",
      city: "Dammam",
      code: "DMM",
      images: [
        // "./assets/Dammam/Dammam/download.jpeg",
        // "./assets/Dammam/Dammam/download%20(1).jpeg",
        // "./assets/Dammam/Dammam/download%20(2).jpeg",
        // "./assets/Dammam/Dammam/images.jpeg",
        "./assets/Mataratpictures/Dammam.jpg",
      ],
      temp: "30°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 5541.1,
          "International Passengers": 5549.7,
        },
        2024: {
          "Domestic Passengers": 6478.4,
          "International Passengers": 6281.4,
        },
      },
    },
    {
      name: "Prince Mohammad bin Abdulaziz International Airport",
      city: "Madinah",
      code: "MED",
      images: ["./assets/Mataratpictures/Medina.png"],
      temp: "36°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 2053.4,
          "International Passengers": 7370,
        },
        2024: {
          "Domestic Passengers": 2759.3,
          "International Passengers": 8278.1,
        },
      },
    },
    {
      name: "Taif International Airport",
      city: "Taif",
      code: "TIF",
      images: ["./assets/Mataratpictures/Altaif.jpg"],
      temp: "36°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 884.8,
          "International Passengers": 373.1,
        },
        2024: {
          "Domestic Passengers": 935.7,
          "International Passengers": 446.2,
        },
      },
    },
    {
      name: "Abha International Airport",
      city: "Abha",
      code: "AHB",
      images: ["./assets/Mataratpictures/Abha.jpeg"],
      temp: "24°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 3519.1,
          "International Passengers": 420.9,
        },
        2024: {
          "Domestic Passengers": 3834.2,
          "International Passengers": 390.9,
        },
      },
    },
    {
      name: "Hail International Airport",
      city: "Hail",
      code: "HAS",
      images: ["./assets/Mataratpictures/Hail.jpg"],
      temp: "29°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 711.5,
          "International Passengers": 233.8,
        },
        2024: {
          "Domestic Passengers": 758,
          "International Passengers": 257.6,
        },
      },
    },
    {
      name: "King Abdullah Bin Abdulaziz International Airport",
      city: "Jazan",
      code: "GIZ",
      images: ["./assets/Mataratpictures/Jazan.jpg"],
      temp: "27°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 2295.8,
          "International Passengers": 83.4,
        },
        2024: {
          "Domestic Passengers": 2415.1,
          "International Passengers": 127.4,
        },
      },
    },
    {
      name: "Prince Sultan bin Abdulaziz International Airport",
      city: "Tabuk",
      code: "TUU",
      images: ["./assets/Mataratpictures/Tabuk.jpg"],
      temp: "27°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 1461.5,
          "International Passengers": 399.3,
        },
        2024: {
          "Domestic Passengers": 1928.9,
          "International Passengers": 502.3,
        },
      },
    },
    {
      name: "Prince Naif bin Abdulaziz International Airport",
      city: "Qassim",
      code: "ELQ",
      images: ["./assets/Mataratpictures/Alqassim.jpg"],
      temp: "33°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 614.9,
          "International Passengers": 683.9,
        },
        2024: {
          "Domestic Passengers": 672,
          "International Passengers": 761.7,
        },
      },
    },
    {
      name: "Prince Abdul Mohsin Bin Abdulaziz International Airport",
      city: "Yanbu",
      code: "YNB",
      images: ["./assets/Mataratpictures/Yanbu.jpg"],
      temp: "33°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 299.6,
          "International Passengers": 195.2,
        },
        2024: {
          "Domestic Passengers": 275.8,
          "International Passengers": 199.9,
        },
      },
    },
    {
      name: "Al-Jouf International Airport",
      city: "Al-Jouf",
      code: "AJF",
      images: ["./assets/Mataratpictures/AlJouf.jpg"],
      temp: "31°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 456.4,
          "International Passengers": 153.6,
        },
        2024: {
          "Domestic Passengers": 445.7,
          "International Passengers": 171.1,
        },
      },
    },
    {
      name: "Al-Ahsa International Airport",
      city: "Al-Ahsa",
      code: "HOF",
      images: ["./assets/Mataratpictures/AlAhsa.jpg"],
      temp: "35°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 153.8,
          "International Passengers": 28.5,
        },
        2024: {
          "Domestic Passengers": 159.4,
          "International Passengers": 8.1,
        },
      },
    },
    {
      name: "Qaisumah International Airport",
      city: "Qaisumah",
      code: "AQI",
      images: ["./assets/Mataratpictures/AlQaisumah.jpg"],
      temp: "34°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 252.3,
          "International Passengers": 37,
        },
        2024: {
          "Domestic Passengers": 258.7,
          "International Passengers": 35.2,
        },
      },
    },
    {
      name: "Al-Ula International Airport",
      city: "Ula",
      code: "ULH",
      images: ["./assets/Mataratpictures/AlUla.jpg"],
      temp: "22°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 161.6,
          "International Passengers": 31.2,
        },
        2024: {
          "Domestic Passengers": 189.7,
          "International Passengers": 40.5,
        },
      },
    },
    {
      name: "Najran International Airport",
      city: "Najran",
      code: "EAM",
      images: ["./assets/Mataratpictures/Najran.jpg"],
      temp: "36°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 821.2,
          "International Passengers": 24.1,
        },
        2024: {
          "Domestic Passengers": 973.9,
          "International Passengers": 56.4,
        },
      },
    },
    {
      name: "Arar International Airport",
      city: "Rae",
      code: "RAE",
      images: ["./assets/Mataratpictures/Arar.jpg"],
      temp: "36°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 319.6,
          "International Passengers": 0,
        },
        2024: {
          "Domestic Passengers": 348.7,
          "International Passengers": 8.7,
        },
      },
    },
    {
      name: "Red Sea Airport",
      city: "Rsi",
      code: "RSI",
      images: ["./assets/Mataratpictures/RedSea.jpg"],
      temp: "36°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 11.2,
          "International Passengers": 0,
        },
        2024: {
          "Domestic Passengers": 76.2,
          "International Passengers": 9.8,
        },
      },
    },
    {
      name: "Neom Bay Airport",
      city: "Neom",
      code: "NUM",
      images: ["./assets/Mataratpictures/Neom.jpg"],
      temp: "36°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "International",
      yearsData: {
        2023: {
          "Domestic Passengers": 110.9,
          "International Passengers": 28.9,
        },
        2024: {
          "Domestic Passengers": 179.4,
          "International Passengers": 54.1,
        },
      },
    },
    {
      name: "King Saud Bin Abdulaziz Airport",
      city: "Al-Aqiq",
      code: "ABT",
      images: ["./assets/Mataratpictures/AlAqiq.jpg"],
      temp: "22°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 3.71,
          Passengers: 343.98,
        },
        2024: {
          Flights: 3.94,
          Passengers: 421.11,
        },
      },
    },

    {
      name: "Bisha Airport",
      city: "Bisha",
      code: "BHH",
      images: ["./assets/Mataratpictures/Bisha.webp"],
      temp: "32°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 3.18,
          Passengers: 377.43,
        },
        2024: {
          Flights: 3.1,
          Passengers: 375.84,
        },
      },
    },
    {
      name: "Dawadmi Airport",
      city: "Dawadmi",
      code: "DWD",
      images: ["./assets/Mataratpictures/Dawadmi.jpeg"],
      temp: "31°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 1.25,
          Passengers: 16.41,
        },
        2024: {
          Flights: 0.76,
          Passengers: 36.77,
        },
      },
    },
    {
      name: "Al-Wajh Airport",
      city: "Al-Wajh",
      code: "EJH",
      images: ["./assets/Mataratpictures/AlWajh.jpeg"],
      temp: "31°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 1.86,
          Passengers: 37.14,
        },
        2024: {
          Flights: 0.35,
          Passengers: 0,
        },
      },
    },
    {
      name: "Qurayyat Airport",
      city: "Qurayyat",
      code: "URY",
      images: ["./assets/Mataratpictures/Gurayat.jpeg"],
      temp: "28°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 1.62,
          Passengers: 184.45,
        },
        2024: {
          Flights: 2.46,
          Passengers: 263.81,
        },
      },
    },

    {
      name: "Rafha Airport",
      city: "Rafha",
      code: "RAH",
      images: ["./assets/Mataratpictures/Rafha.jpeg"],
      temp: "32°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 0.76,
          Passengers: 81.62,
        },
        2024: {
          Flights: 1.01,
          Passengers: 96.87,
        },
      },
    },
    {
      name: "Rabigh Airport",
      city: "Rabigh",
      code: "RGB",
      images: ["./assets/Mataratpictures/Rabigh.jpg"],
      temp: "32°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 0.03,
          Passengers: 0,
        },
        2024: {
          Flights: 0.06,
          Passengers: 0.04,
        },
      },
    },
    {
      name: "Sharurah Airport",
      city: "Sharurah",
      code: "SHW",
      images: ["./assets/Mataratpictures/Sharurah.webp"],
      temp: "37°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 2.61,
          Passengers: 236.64,
        },
        2024: {
          Flights: 1.8,
          Passengers: 197.56,
        },
      },
    },
    {
      name: "Turaif Airport",
      city: "Turaif",
      code: "TUI",
      images: ["./assets/Mataratpictures/Turaif.jpeg"],
      temp: "26°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 0.98,
          Passengers: 97.24,
        },
        2024: {
          Flights: 1.4,
          Passengers: 135.3,
        },
      },
    },
    {
      name: "Wadi Al Dawasir Airport",
      city: "Wadi Al Dawasir",
      code: "WAE",
      images: ["./assets/Mataratpictures/WadiAlDawasir.jpeg"],
      temp: "35°",
      time: "",
      timezone: "Asia/Riyadh",
      airportType: "Domestic",
      yearsData: {
        2023: {
          Flights: 1.27,
          Passengers: 107.63,
        },
        2024: {
          Flights: 1.26,
          Passengers: 126.06,
        },
      },
    },
  ];

  // Make sure this is global
  window.saudiAirports = saudiAirports;

  window.setAirportByCode = function (code) {
    console.log(`setAirportByCode ${code}`);

    const idx = (window.saudiAirports || []).findIndex((a) => a.code === code);
    if (idx < 0) return console.warn("Airport code not found:", code);
    // Sync both carousels/contexts
    currentAirportIndex = idx;
    currentImageIndex = 0; // reset image rotation to first image
    // Keep flight section in sync too
    if (typeof currentFlightAirportIndex !== "undefined") {
      currentFlightAirportIndex = idx;
    }

    // Update UI and timers for the main airport slider
    againInitializeAirportSlider();

    // Update progress indicators and flights list

    if (typeof filterFlightsByAirport === "function") {
      // filterFlightsByAirport();
    }

    // Highlight on map; if not ready yet, store pending code
    if (typeof setActiveAirportArrow === "function") {
      try {
        setActiveAirportArrow(code);
      } catch (_) {}
    } else if (typeof window !== "undefined") {
      window.pendingMapHighlight = code;
    }
  };

  // Update the dropdown with current language translations
  updateAirportDropdown();
});

// ------------------ Map & Routes Sections Start --------------------

const FLIGHTS_PER_PAGE = 12;
let currentFlightPage = 0;
let totalFlightPages = 1;

// for pins on map - Start
const airportPointers = document.querySelectorAll(".airport");
const highlightLayer = document.getElementById("highlights");
const svg = document.getElementById("saudi-map");

airportPointers.forEach((airport) => {
  airport.addEventListener("click", () => {
    const name = airport.getAttribute("data-name");
    const code = airport.getAttribute("data-code");
    console.log(`Clicked: ${name} (${code})`);
    window.setAirportByCode(code);
    airportPointers.forEach((pointer) => pointer.classList.remove("enlarged"));
    airport.classList.add("enlarged");

    highlightLayer.innerHTML = "";

    // Get pin position (x, y are strings → convert to numbers)
    const x = parseFloat(airport.getAttribute("x"));
    const y = parseFloat(airport.getAttribute("y"));
    const targetRadius = 80; // final radius

    // Create highlight circle
    const circle = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "circle"
    );
    circle.setAttribute("class", "highlight");
    circle.setAttribute("cx", x + 28); // center (adjust +12 if pin width=24)
    circle.setAttribute("cy", y + 104); // center (adjust +12 if pin height=24)
    circle.setAttribute("r", 0); // radius
    // circle.setAttribute("fill", "rgb(52, 209, 159)");
    circle.setAttribute("fill", "url(#highlight-gradient)");
    // circle.setAttribute("stroke", "rgb(52,209,159)");

    circle.setAttribute("pointer-events", "none");

    // Append to highlight layer
    highlightLayer.appendChild(circle);

    // Trigger the transition a tiny bit later
    requestAnimationFrame(() => {
      circle.setAttribute("r", targetRadius);
    });
  });
});
// for pins on map - End

function generateFlightData() {
  const flights = [];
  const destinations = [
    {
      Route: "PKX-RUH",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-HAK",
      airline: "HAINAN",
      started: "Yes",
      yearStarted: 2025,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "XYI-RUH",
      airline: "HAINAN",
      started: "No",
      yearStarted: "-",
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "BCN-JED",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "ZRH-RUH",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "TUN-JED",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Africa",
    },
    {
      Route: "KUL-JED",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "AMS-JED",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "ICN-RUH",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "MRS-JED",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "ALA-JED",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "JED-ALG-MED",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "JED-CMN-MED",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "FCO-DMM",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "VIE-DMM",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "BUD-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "BUD-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "TIA-DMM",
      airline: "Wizz Air",
      started: "No",
      yearStarted: "-",
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "BUD-DMM",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2022,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "TIA-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "MXP-DMM",
      airline: "Wizz Air",
      started: "No",
      yearStarted: "-",
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "AUH-DMM",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "AUH-MAD",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "CTA-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "FCO-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "FCO-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "VCE-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "VCE-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "VIE-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "VIE-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "MXP-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "NAP-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "OTP-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "OTP-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "SOF-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "LCA-DMM",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "LCA-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "LCA-RUH",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Asia",
    },
    {
      Route: "MXP-JED",
      airline: "Wizz Air",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2022,
      continent: "Europe",
    },
    {
      Route: "JED-BHX",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-JNB",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-KAN",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-TAS",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-OSS",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-FRU",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-ABV",
      airline: "Flynas",
      started: "No",
      yearStarted: "-",
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-BGW-MED",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-BRU",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "JED-BER",
      airline: "Flynas",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "WAW-RUH",
      airline: "LOT",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Europe",
    },
    {
      Route: "YYZ-JED",
      airline: "SAUDIA",
      started: "Yes",
      yearStarted: 2023,
      ContractedSupportedYear: 2023,
      continent: "Asia",
    },
    {
      Route: "HKG-RUH",
      airline: "CATHAY",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "SZX-RUH",
      airline: "China Southern",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "PKX-RUH",
      airline: "China Southern",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "BER-JED",
      airline: "Eurowings",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "CGN-JED",
      airline: "Eurowings",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "LHR-JED",
      airline: "BA",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Europe",
    },
    {
      Route: "ORY-JED",
      airline: "Transavia",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "LYS-JED",
      airline: "Transavia",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "PVG-RUH",
      airline: "China Eastern",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "FCO-RUH",
      airline: "ITA",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Europe",
    },
    {
      Route: "FCO-JED",
      airline: "ITA",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Europe",
    },
    {
      Route: "SKD-JED",
      airline: "Air Samarkand",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "LHR-RUH",
      airline: "Virgin",
      started: "Yes",
      yearStarted: 2025,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "DOH-NUM",
      airline: "Qatar",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "DOH-ABH",
      airline: "Qatar",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "SAW-DMM",
      airline: "Ajet",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "SAW-JED",
      airline: "Ajet",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "SAW-RUH",
      airline: "Ajet",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "SAW-MED",
      airline: "Ajet",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "ESB-JED",
      airline: "Ajet",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "ESB-MED",
      airline: "Ajet",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
    {
      Route: "PEK-RUH",
      airline: "Air China",
      started: "Yes",
      yearStarted: 2024,
      ContractedSupportedYear: 2024,
      continent: "Asia",
    },
  ];

  destinations.forEach((d) => {
    if (d.Route) {
      const parts = d.Route.split("-");
      if (parts.length === 2) {
        flights.push({
          from: parts[0],
          to: parts[1],
          airline: d.airline,
          started: d.started,
          yearStarted: d.yearStarted,
          contractedYear: d.ContractedSupportedYear,
          continent: d.continent || "Asia",
        });
      } else if (parts.length > 2) {
        for (let i = 0; i < parts.length - 1; i++) {
          flights.push({
            from: parts[i],
            to: parts[i + 1],
            airline: d.airline,
            started: d.started,
            yearStarted: d.yearStarted,
            contractedYear: d.ContractedSupportedYear,
          });
        }
      }
    }
  });
  return flights;
}

let flightData = generateFlightData();

let currentAirportIndex = 0;
let currentImageIndex = 0;
let imageRotationInterval;
let airportImageRotationInterval;
let progressAnimationInterval;

function initializeAirportSlider() {
  updateAirportDisplay();
  startImageRotation();
  startAirportImageRotation();
  // initializeProgressSlider();
}

// run when airport is selected from map, this will set airport slider
function againInitializeAirportSlider() {
  updateAirportDisplay();
  restartImageRotation();
}

function updateAirportDisplay() {
  const airport = saudiAirports[currentAirportIndex];
  console.log(airport);

  // Update airport info
  document.getElementById("airportName").textContent = `${airport.name}`;
  document.getElementById("year1").textContent = 2023;
  document.getElementById("year2").textContent = 2024;

  if (airport.airportType === "International") {
    document.getElementById("intlLabel").textContent =
      "International Passengers";
    document.getElementById("domLabel").textContent = "Domestic Passengers";

    document.getElementById("intl1").textContent =
      airport.yearsData["2023"]["International Passengers"];
    document.getElementById("intl2").textContent =
      airport.yearsData["2024"]["International Passengers"];
    document.getElementById("dom1").textContent =
      airport.yearsData["2023"]["Domestic Passengers"];
    document.getElementById("dom2").textContent =
      airport.yearsData["2024"]["Domestic Passengers"];
  } else {
    document.getElementById("intlLabel").textContent = "Flights";
    document.getElementById("domLabel").textContent = "Passengers";
    document.getElementById("intl1").textContent =
      airport.yearsData["2023"]["Flights"];
    document.getElementById("intl2").textContent =
      airport.yearsData["2024"]["Flights"];
    document.getElementById("dom1").textContent =
      airport.yearsData["2023"]["Passengers"];
    document.getElementById("dom2").textContent =
      airport.yearsData["2024"]["Passengers"];
  }

  updateAirportImageSlider();
  // Start/refresh dynamic time updater
  // startTimeUpdater();
}

function updateAirportImageSlider() {
  const airport = saudiAirports[currentAirportIndex];
  const imageSliderContainer = document.getElementById("airport-image-slider");

  imageSliderContainer.innerHTML = `
                <img src="${airport.images[currentImageIndex]}" 
                     alt="${airport.name}" 
                     class="w-full h-full object-cover transition-opacity duration-500">
            `;
}

function startImageRotation() {
  imageRotationInterval = setInterval(() => {
    const airport = saudiAirports[currentAirportIndex];
    currentImageIndex = (currentImageIndex + 1) % airport.images.length;
    // resetProgress();
    // setTimeout(() => startProgressAnimation(), 100);
  }, 3000);
}

function startAirportImageRotation() {
  airportImageRotationInterval = setInterval(() => {
    const airport = saudiAirports[currentAirportIndex];
    const nextImageIndex = (currentImageIndex + 1) % airport.images.length;
    updateAirportImageSlider();
  }, 3000);
}

function restartImageRotation() {
  clearInterval(imageRotationInterval);
  clearInterval(airportImageRotationInterval);
  clearInterval(progressAnimationInterval);
  // if (timeUpdateInterval) clearInterval(timeUpdateInterval);
  startImageRotation();
  startAirportImageRotation();
  // resetProgress();
  // setTimeout(() => startProgressAnimation(), 100);
  // startTimeUpdater();
}

// Flight data is already generated by generateFlightData() function above

// currentFlightPage is already declared at line 707
let currentFlightAirportIndex = 0;
let currentContinentPage = 0;
let filteredFlights = [...flightData];
const flightsPerPage = 12;
let activeFilters = [];

function filterFlights(query) {
  console.log("Filtering flights with query:", query);
  if (query.length === 0) {
    filteredFlights = [...flightData];
  } else {
    filteredFlights = flightData.filter(
      (flight) =>
        flight.from.toLowerCase().includes(query) ||
        flight.to.toLowerCase().includes(query)
    );
  }
  currentFlightPage = 0;
  renderFlightCards();
}

function filterFlightsByAirport() {
  const currentAirport = saudiAirports[currentFlightAirportIndex];
  filteredFlights = flightData.filter(
    (flight) =>
      flight.from === currentAirport.code || flight.to === currentAirport.code
  );
  currentFlightPage = 0;
  renderFlightCards();
}

function renderFlightCards() {
  const grid = document.getElementById("flight-cards-grid");

  // Calculate pagination
  totalFlightPages = Math.ceil(filteredFlights.length / FLIGHTS_PER_PAGE);
  const startIndex = currentFlightPage * FLIGHTS_PER_PAGE;
  const endIndex = Math.min(
    startIndex + FLIGHTS_PER_PAGE,
    filteredFlights.length
  );
  const currentPageFlights = filteredFlights.slice(startIndex, endIndex);

  // Update pagination display
  updateFlightPaginationDisplay();

  grid.innerHTML = currentPageFlights
    .map(
      (flight) => `
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:bg-emerald-50 hover:border-emerald-200 transition-all duration-200 cursor-pointer">
                    <!-- Airport codes with arrow -->
                    <div class="flex items-center justify-center mb-6">
                        <div class="flex items-center space-x-4">
                            <span class="text-2xl font-bold text-gray-800">${
                              flight.from
                            }</span>
                            <svg class="w-6 h-6 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                            <span class="text-2xl font-bold text-gray-800">${
                              flight.to
                            }</span>
                        </div>
                    </div>
                    
                    <!-- Three data sections -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center flex flex-col justify-between">
                            <div class="flex items-center justify-center mb-2">
                                <span class="text-xs text-gray-500" data-i18n="flights.airline">Airline</span>
                            </div>
                            <div class="text-lg font-bold text-gray-800">${flight.airline.toLocaleString()}</div>
                        </div>
                        
                        <div class="text-center flex flex-col justify-between">
                            <div class="flex items-center justify-center mb-2">
                                <span class="text-xs text-gray-500" data-i18n="flights.started">Started?</span>
                            </div>
                            <div class="text-lg font-bold text-gray-800" data-i18n="${
                              flight.started === "Yes"
                                ? "flights.startedYes"
                                : "flights.startedNo"
                            }">${flight.started.toLocaleString()}</div>
                        </div>
                        
                        <div class="text-center flex flex-col justify-between">
                            <div class="flex items-center justify-center mb-2">
                                <span class="text-xs text-gray-500" data-i18n="flights.yearStarted">Year Started</span>
                            </div>
                            <div class="text-lg font-bold text-gray-800">${
                              flight.yearStarted
                            }</div>
                        </div>
                    </div>
                </div>
            `
    )
    .join("");

  // Update translations for the newly rendered flight cards
  updateAirportDropdown();
}

function updateFlightPaginationDisplay() {
  document.getElementById("current-flight-page").textContent = String(
    currentFlightPage + 1
  ).padStart(2, "0");
  document.getElementById("total-flight-pages").textContent = String(
    totalFlightPages
  ).padStart(2, "0");

  const progress =
    totalFlightPages > 1
      ? ((currentFlightPage + 1) / totalFlightPages) * 100
      : 100;
  document.getElementById("flight-page-progress").style.width = `${progress}%`;
}

function initializeFlightSearch() {
  console.log("Hello");
  currentFlightAirportIndex = 0;
  filteredFlights = [...flightData];
  currentContinentPage = 0;
  currentFlightPage = 0;
  activeFilters = [];
  renderFlightCards();
  setupFlightSearchListeners();
  updateContinentProgress();
}

function againInitializeFlightSearch() {
  console.log("Hello");
  currentFlightAirportIndex = 0;
  filteredFlights = [...flightData];
  currentContinentPage = 0;
  currentFlightPage = 0;
  activeFilters = [];
  renderFlightCards();
  updateContinentProgress();
}

function setupFlightSearchListeners() {
  const searchInput = document.getElementById("flight-search");
  const searchResults = document.getElementById("flight-search-results");

  searchInput.addEventListener("input", function () {
    console.log("filter by airport");

    const query = this.value.toLowerCase().trim();

    if (query.length === 0) {
      searchResults.classList.add("hidden");
      // Reset to show all flights for current airport
      filterFlightsByAirport();
      return;
    }

    // Show search suggestions
    const filteredAirports = saudiAirports.filter(
      (airport) =>
        airport.name.toLowerCase().includes(query) ||
        airport.city.toLowerCase().includes(query) ||
        airport.code.toLowerCase().includes(query)
    );

    displayFlightSearchResults(filteredAirports);

    // Filter flights based on search
    // filterFlights(query);
  });

  // Hide results when clicking outside
  document.addEventListener("click", function (event) {
    if (
      !searchInput.contains(event.target) &&
      !searchResults.contains(event.target)
    ) {
      searchResults.classList.add("hidden");
    }
  });

  // Flight pagination
  document.getElementById("flight-prev-page").addEventListener("click", () => {
    if (currentFlightPage > 0) {
      currentFlightPage--;
      renderFlightCards();
    }
  });

  document.getElementById("flight-next-page").addEventListener("click", () => {
    if (currentFlightPage < totalFlightPages - 1) {
      currentFlightPage++;
      renderFlightCards();
    }
  });

  // Continent pagination
  document.getElementById("continent-prev").addEventListener("click", () => {
    currentContinentPage = Math.max(0, currentContinentPage - 1);
    updateContinentProgress();
  });

  document.getElementById("continent-next").addEventListener("click", () => {
    console.log("click", currentContinentPage);
    if (currentContinentPage < 1) {
      currentContinentPage = Math.min(2, currentContinentPage + 1);
      updateContinentProgress();
    }
  });
}

function displayFlightSearchResults(airports) {
  const searchResults = document.getElementById("flight-search-results");

  if (airports.length === 0) {
    searchResults.innerHTML =
      '<div class="p-3 text-gray-500 text-sm" data-i18n="search.noAirportsFound">No airports found</div>';
    searchResults.classList.remove("hidden");

    // Update translation for the no results message
    const noResultsItem = searchResults.querySelector("[data-i18n]");
    if (noResultsItem) {
      const key = noResultsItem.getAttribute("data-i18n");
      if (key) {
        noResultsItem.textContent = i18next.t(key);
      }
    }
    return;
  }

  const resultsHTML = airports
    .map(
      (airport) => `
                <div class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0" onclick="selectFlightAirport('${
                  airport.name
                }', '${airport.city}', '${
        airport.code
      }', ${saudiAirports.indexOf(airport)})">
                    <div class="font-medium text-gray-800" data-i18n="search.${
                      airport.name
                    }">${airport.name}</div>
                    <div class="text-sm text-gray-600">${airport.city} (${
        airport.code
      })</div>
                </div>
            `
    )
    .join("");

  searchResults.innerHTML = resultsHTML;
  searchResults.classList.remove("hidden");

  // Update translations for the search results
  const resultItems = searchResults.querySelectorAll("[data-i18n]");
  resultItems.forEach((item) => {
    const key = item.getAttribute("data-i18n");
    if (key) {
      item.textContent = i18next.t(key);
    }
  });
}

function selectFlightAirport(name, city, code, index) {
  console.log("Selected airport:", name, city, code, index);

  const searchInput = document.getElementById("flight-search");
  const searchResults = document.getElementById("flight-search-results");

  searchInput.value = `${name} - ${city} (${code})`;
  searchResults.classList.add("hidden");

  // Update current airport index and sync everything
  currentFlightAirportIndex = index;

  // clear other filters
  activeFilters = [];
  // add airport filter
  activeFilters["airport"] = saudiAirports[currentFlightAirportIndex].name;
  console.log(activeFilters);

  filterFlightsByAirport();
}

function filterFlights(query) {
  if (!query) {
    filterFlightsByAirport();
    return;
  }

  const currentAirport = saudiAirports[currentFlightAirportIndex];
  const airportFlights = flightData.filter(
    (flight) =>
      flight.from === currentAirport.code || flight.to === currentAirport.code
  );

  filteredFlights = airportFlights.filter((flight) => {
    // Search in destination airport names and codes
    const destinationAirport = saudiAirports.find(
      (airport) =>
        airport.code ===
        (flight.from === currentAirport.code ? flight.to : flight.from)
    );

    if (destinationAirport) {
      return (
        destinationAirport.name.toLowerCase().includes(query) ||
        destinationAirport.city.toLowerCase().includes(query) ||
        destinationAirport.code.toLowerCase().includes(query)
      );
    }

    return (
      flight.from.toLowerCase().includes(query) ||
      flight.to.toLowerCase().includes(query)
    );
  });

  currentFlightPage = 0;
  renderFlightCards();
}

// continents to show in sidebar
const continents = [
  { name: "Asia", image: "./assets/svg/Asia.svg" },
  { name: "Europe", image: "./assets/svg/Europe.svg" },
  { name: "Africa", image: "./assets/svg/Africa.svg" },
  { name: "North America", image: "./assets/svg/North-America.svg" },
  { name: "South America", image: "./assets/svg/South-America.svg" },
  { name: "Australia", image: "./assets/svg/Australia.svg" },
];

const CONTINENTS_PER_PAGE = 3;

//   let currentContinentPage = 0;
let selectedContinent = null; // null => show all continents

function renderContinents() {
  const container = document.getElementById("continent-cards");
  const start = currentContinentPage * CONTINENTS_PER_PAGE;
  const end = start + CONTINENTS_PER_PAGE;
  const visible = continents.slice(start, end);

  container.innerHTML = visible
    .map((c, i) => {
      const globalIndex = start + i;
      const isSelected = selectedContinent === c.name;
      return `
            <div id="continent-card-${globalIndex}" data-index="${globalIndex}" onclick="selectFlightContinent('${
        c.name
      }', 'continent-card-${globalIndex}')" class="flex flex-col items-center mt-2 mb-6 cursor-pointer">
                <div class='w-24 h-24 border border-gray-200 rounded'>
                    <img src="${c.image}" alt="${
        c.name
      }" class="w-full h-full object-fill"/>
                </div>
                <p class="!text-sm text-gray-600 text-center" data-i18n="continent.${c.name.toLowerCase()}">${
        c.name
      }</p>
            </div>
          `;
    })
    .join("");

  // Update continent cards if they exist
  if (container) {
    const continentCard = container.querySelectorAll("[data-i18n]");
    continentCard.forEach((card) => {
      const key = card.getAttribute("data-i18n");
      if (key) {
        card.textContent = i18next.t(key);
      }
    });
  }
}

// update continent progress bar
function updateContinentProgress() {
  const totalContinentPages = Math.max(
    1,
    Math.ceil(continents.length / CONTINENTS_PER_PAGE)
  );
  const progress = ((currentContinentPage + 1) / totalContinentPages) * 100;
  document.getElementById("continent-progress").style.width = `${progress}%`;

  document.getElementById("current-continent-page").textContent = String(
    currentContinentPage + 1
  ).padStart(2, "0");
  document.getElementById("total-continent-pages").textContent = String(
    totalContinentPages
  ).padStart(2, "0");

  // render cards for this page
  renderContinents();
}

function selectFlightContinent(name, continentCard) {
  console.log("Selected Continent:", name, continentCard);

  if (selectedContinent === name) {
    selectedContinent = null;
    againInitializeFlightSearch();
  } else {
    console.log(activeFilters);
    selectedContinent = name;

    // clear other filters
    activeFilters = [];

    const container = document.getElementById("continent-cards");

    // Select only direct child divs
    const childDivs = container.querySelectorAll(":scope > div");

    childDivs.forEach((div, index) => {
      // console.log("Div #" + index, div);
      const continentSvg = div.getElementsByTagName("img")[0];
      continentSvg.classList.remove("bg-emerald-100");
    });

    const continent = document.getElementById(continentCard);
    const continentSvg = continent.getElementsByTagName("img")[0];
    continentSvg.classList.add("bg-emerald-100");

    filterFlightsByContinent();
  }
}

function filterFlightsByContinent() {
  // const currentAirport = saudiAirports[currentFlightAirportIndex];
  filteredFlights = flightData.filter(
    (flight) => flight.continent === selectedContinent
  );
  currentFlightPage = 0;
  renderFlightCards();
}

// ------------------ Map & Routes Section End --------------------

// ------------------ News Section Start --------------------

let currentNewsSlide = 1;
const newsData = [
  {
    id: 1,
    image: "./assets/news/abha.png",
    headline:
      "Flights between Abha and Doha Resumed, First Aircraft Landed at Abha International Airport",
    description:
      "The Air Connectivity Program (ACP) has thanked Qatar Airways for the resumption of direct flights between Doha and Abha in collaboration with Discover Aseer and Abha International Airport.",
    location: "Abha, KSA",
    date: "02 January 2025",
  },
  {
    id: 2,
    image: "./assets/news/munich.png",
    headline:
      "Air Connectivity Program Welcomes Lufthansa’s New Direct Munich to Riyadh Flights",
    description:
      "The Saudi Air Connectivity Program (ACP) has welcomed Lufthansa’s launch of direct flights from Munich to Riyadh, with three weekly flights set to begin on October 27 of this year.",
    location: "Riyadh, KSA",
    date: "19 August 2025",
  },
  {
    id: 3,
    image: "./assets/news/china.jpg",
    headline:
      "China Southern Airlines Launches New Route between Guangzhou, Riyadh",
    description:
      "China Southern Airlines, in cooperation with the Air Connectivity Program, the Saudi Tourism Authority, and Riyadh Airports Company, has announced the launch of a new flight route between Guangzhou in China and Riyadh, starting in September 2025. The route will operate three times per week, adding over 86,000 seats annually to this route.",
    location: "Riyadh, KSA",
    date: "17 July 2025",
  },
  {
    id: 4,
    image: "./assets/news/haikou.jpg",
    headline:
      "King Abdulaziz International Airport Launches First Hainan Airlines Flights",
    description:
      "King Abdulaziz International Airport in Jeddah today welcomed the inaugural flight of China’s Hainan Airlines, marking the launch of the first direct route between Jeddah and the Chinese city of Haikou.",
    location: "Jeddah, KSA",
    date: "28 July 2025",
  },
  {
    id: 5,
    image: "./assets/news/virgin.png",
    headline:
      "Riyadh Welcomes First Virgin Atlantic Heathrow Flight, Boosting Global Tourism Status",
    description:
      "King Khalid International Airport today welcomed the inaugural flight of British airline Virgin Atlantic, arriving from London Heathrow and carrying the company's founder, Richard Branson.",
    location: "Riyadh, KSA",
    date: "23 April 2025",
  },
  {
    id: 6,
    image: "./assets/news/madina.jpg",
    headline:
      "Air Connectivity Program, MDA Partner with Transavia France to Launch New Flight Routes to Madinah.",
    description:
      "The Air Connectivity Program (ACP), in partnership with the Al Madinah Region Development Authority (MDA), has announced the expansion of Transavia France's travel services to Saudi Arabia. Beginning in October, new routes will be launched from Paris-Orly, Lyon, Marseille, and Toulouse to Madinah.",
    location: "Madinah, KSA",
    date: "17 April 2025",
  },
  {
    id: 7,
    image: "./assets/news/stuttgart.jpg",
    headline:
      "Saudi Air Connectivity Program Launches Direct Flights from Stuttgart to Jeddah",
    description:
      "The Saudi Air Connectivity Program (ACP), in collaboration with the Saudi Tourism Authority (STA) and Jeddah Airports Company (JEDCO), announced on Tuesday the launch of direct flights from Stuttgart, Germany, to Jeddah.",
    location: "Jeddah, KSA",
    date: "05 March 2025",
  },
];

function createNewsCard(news, index) {
  return `
    <div 
      class="news-card w-[100%] sm:w-[100%] md:w-[50%] flex-shrink-0 border border-gray-300 bg-white rounded-md shadow-sm hover:shadow-sm transition-shadow duration-300 p-6 cursor-pointer opacity-[${
        news.id == 1 ? 1 : 0.5
      }]" 
      data-id="${news.id}">
        <!-- your existing card content unchanged -->
        <div class="flex flex-col gap-6 h-full">
            <div class="flex justify-between">
                <div class="w-2/5">
                    <h4 class="text-xl font-bold text-gray-800 mb-4 line-clamp-2" data-i18n="articles.featured.${
                      news.id
                    }.title">
                        ${news.headline}
                    </h4>
                    <p class="text-gray-600 mb-6 line-clamp-3 flex-grow" data-i18n="articles.featured.${
                      news.id
                    }.description">
                        ${news.description}
                    </p>
                </div>
                <div class="w-3/5 ml-3 h-48 overflow-hidden">
                    <img src="${
                      news.image
                    }" alt="News Image" class="w-full h-full object-cover">
                </div>
            </div>
            <div class="flex items-center justify-between">
                <div class="text-[12px] text-gray-400">
                    <span class="border border-gray-300 p-2 rounded-sm">${
                      news.location
                    }</span>
                    <span class="border border-gray-300 p-2 rounded-sm" data-i18n="articles.featured.${
                      index + 1
                    }.date">${news.date}</span>
                </div>
                <button 
                  class="read-more-btn hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm font-medium transition-colors flex items-center space-x-2"
                  data-id="${news.id}">
                  <span class="text-sm text-gray-600" data-i18n="buttons.readMore">Read More</span>
                  <span class="w-8 h-8 rounded-full bg-gray-600 text-white flex items-center justify-center" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                  </span>
                </button>

            </div>
        </div>
    </div>
  `;
}

// Modal Functionality Start
// 📰 Modal Elements
const modal = document.getElementById("newsModal");
const closeModalBtn = document.getElementById("closeModal");
const modalTitle = document.getElementById("modalTitle");
const modalDate = document.getElementById("modalDate");
const modalImage = document.getElementById("modalImage");
const modalDescription = document.getElementById("modalDescription");

/**
 * Attach read-more functionality to your slider container.
 * Replace "#news-slider-track" with the actual container element of your slider.
 */
const sliderTrack = document.getElementById("news-slider-track");

// use event delegation so buttons added later also work
sliderTrack.addEventListener("click", (e) => {
  const button = e.target.closest(".read-more-btn");
  if (!button) return;

  e.stopPropagation();

  // find the card id
  const id = parseInt(button.dataset.id, 10);

  // ✅ Use i18next to fetch the translated content
  const titleKey = `articles.featured.${id}.title`;
  const descKey = `articles.featured.${id}.description`;
  const dateKey = `articles.featured.${id}.date`;

  const news = newsData.find((item) => item.id === id);

  // Populate modal with translated content
  modalTitle.textContent = i18next.t(titleKey);
  modalDescription.textContent = i18next.t(descKey);

  // You can still pull location from newsData (if you don’t have translations for it)
  const translatedDate = i18next.t(dateKey);
  modalDate.textContent = `${translatedDate} • ${news.location}`;

  modalImage.src = news.image;

  modal.classList.remove("hidden");
});
i18next.on("languageChanged", () => {
  // if modal open, retranslate content
  if (!modal.classList.contains("hidden")) {
    const id = modal.dataset.currentId; // store current ID somewhere when opening
    if (id) {
      modalTitle.textContent = i18next.t(`articles.featured.${id}.title`);
      modalDescription.textContent = i18next.t(
        `articles.featured.${id}.description`
      );
      modalDate.textContent = `${i18next.t(`articles.featured.${id}.date`)} • ${
        newsData.find((n) => n.id == id).location
      }`;
    }
  }
});

// close modal
closeModalBtn.addEventListener("click", () => {
  modal.classList.add("hidden");
});

// close modal when clicking outside
modal.addEventListener("click", (e) => {
  if (e.target === modal) {
    modal.classList.add("hidden");
  }
});

// Modal Functionality End

function renderNewsSlider() {
  const sliderTrack = document.getElementById("news-slider-track");
  const totalSlides = newsData.length;

  let slidesHTML = "";
  slidesHTML += `
                        ${newsData
                          .map((news, index) => createNewsCard(news, index))
                          .join("")}
                        ${newsData.length === 1 ? "<div></div>" : ""}
                `;
  sliderTrack.innerHTML = slidesHTML;

  // Update news cards translations if they exist
  if (sliderTrack) {
    const newsCard = sliderTrack.querySelectorAll("[data-i18n]");
    newsCard.forEach((card) => {
      const key = card.getAttribute("data-i18n");
      if (key) {
        card.textContent = i18next.t(key);
      }
    });
  }

  // 🔥 Add click listeners on cards
  const cards = document.querySelectorAll(".news-card");
  cards.forEach((card, idx) => {
    card.addEventListener("click", () => {
      const clickedIndex = idx + 1;

      if (clickedIndex === currentNewsSlide) {
        // active card clicked → do nothing (or open details)
        return;
      }

      if (
        clickedIndex ===
        (currentNewsSlide === 1 ? totalSlides : currentNewsSlide - 1)
      ) {
        // previous card clicked
        slideNews("prev");
      } else if (
        clickedIndex ===
        (currentNewsSlide === totalSlides ? 1 : currentNewsSlide + 1)
      ) {
        // next card clicked
        slideNews("next");
      }
      // If you want clicks on far-away cards to jump directly,
      // you can extend this block later.
    });
  });

  // Update progress segments
  updateNewsProgress();

  // Update navigation text
  updateNewsNavigation();
}

function updateNewsProgress() {
  const progressContainer = document.getElementById("news-progress-container");
  const totalSlides = newsData.length;

  let progressHTML = "";
  for (let i = 1; i <= totalSlides; i++) {
    const isActive = i === currentNewsSlide;
    progressHTML += `
                    <div class="flex-1 h-1 rounded-full ${
                      isActive ? "bg-gray-600" : "bg-gray-300"
                    } transition-colors duration-300"></div>
                `;
  }

  progressContainer.innerHTML = progressHTML;
}

function updateNewsNavigation() {
  const totalSlides = newsData.length;

  // Update current slide number
  document.getElementById("current-news-slide").textContent = String(
    currentNewsSlide
  ).padStart(2, "0");

  // Update total slides
  document.getElementById("total-news-slides").textContent = String(
    totalSlides
  ).padStart(2, "0");

  // Update progress bar
  const progressPercentage =
    totalSlides > 1 ? (currentNewsSlide / totalSlides) * 100 : 100;
  document.getElementById(
    "news-slider-progress"
  ).style.width = `${progressPercentage}%`;
}

function slideNews(direction) {
  console.log("news btn");

  const totalSlides = newsData.length;
  const sliderTrack = document.getElementById("news-slider-track");

  if (direction === "next") {
    let activeNewsCard =
      document.querySelectorAll(".news-card")[currentNewsSlide - 1];
    activeNewsCard.style.opacity = "0.5";
    // currentNewsSlide++;
    currentNewsSlide =
      currentNewsSlide === totalSlides ? 1 : currentNewsSlide + 1;
    activeNewsCard =
      document.querySelectorAll(".news-card")[currentNewsSlide - 1];
    activeNewsCard.style.opacity = "1";
    // activeNewsCard.classList.add('activeNewsCard');
    console.log(activeNewsCard);
  } else if (direction === "prev") {
    let activeNewsCard =
      document.querySelectorAll(".news-card")[currentNewsSlide - 1];
    activeNewsCard.style.opacity = "0.5";
    // currentNewsSlide--;
    currentNewsSlide =
      currentNewsSlide === 1 ? totalSlides : currentNewsSlide - 1;
    activeNewsCard =
      document.querySelectorAll(".news-card")[currentNewsSlide - 1];
    activeNewsCard.style.opacity = "1";
  }

  // Apply transform
  const langSelected = document.documentElement.lang;
  let translateX;

  const isMobile = window.innerWidth < 768; // tailwind md breakpoint
  if (isMobile) {
    // full width slide
    translateX =
      langSelected == "ar"
        ? (currentNewsSlide - 1) * 104
        : -(currentNewsSlide - 1) * 104;
  } else {
    // peeked cards slide
    translateX =
      langSelected == "ar"
        ? -25 + (currentNewsSlide - 1) * 50
        : 25 - (currentNewsSlide - 1) * 50;
  }

  sliderTrack.style.transform = `translateX(${translateX}%)`;

  // Update progress and navigation
  updateNewsProgress();
  updateNewsNavigation();
}

function initializeNewsSlider() {
  renderNewsSlider();

  // Add event listeners
  document
    .getElementById("news-prev")
    .addEventListener("click", () => slideNews("prev"));
  document
    .getElementById("news-next")
    .addEventListener("click", () => slideNews("next"));
}

document.addEventListener("DOMContentLoaded", function () {
  initializeAirportSlider();
  initializeFlightSearch();
  initializeNewsSlider();
  selectableStatsCards();
});

// ------------------ Animations Start --------------------

(function () {
  const getTextEl = () => document.getElementById("gsap-text");
  let letters = [];
  let currentIndex = 0;
  let animationFinished = false;
  let isRTL = false;
  const charsPerScroll = 1;
  const visibilityRatio = 0.8;

  let autoRevealStarted = false;
  let autoRevealInterval = null;

  function splitIntoWords(node) {
    const el = node;
    const text = el.textContent || "";
    el.innerHTML = "";

    const segments = text.split(/(\s+)/);
    const frag = document.createDocumentFragment();

    segments.forEach((segment) => {
      if (segment.trim() === "") {
        frag.appendChild(document.createTextNode(segment));
      } else {
        const span = document.createElement("span");
        span.className = "word text-gray-400 inline-block";
        span.textContent = segment;
        frag.appendChild(span);
      }
    });

    el.appendChild(frag);
    return Array.from(el.querySelectorAll(".word"));
  }

  // NEW: sort spans by their actual position in the viewport
  function sortByPosition(spans, rtl) {
    return spans
      .map((span) => ({
        el: span,
        rect: span.getBoundingClientRect(),
      }))
      .sort((a, b) => {
        // sort top first
        if (a.rect.top !== b.rect.top) {
          return a.rect.top - b.rect.top;
        }
        // then by horizontal position based on direction
        return rtl ? b.rect.left - a.rect.left : a.rect.left - b.rect.left;
      })
      .map((item) => item.el);
  }

  function resetLettersState() {
    animationFinished = false;
    letters.forEach((l) => {
      l.classList.remove("text-black");
      l.classList.add("text-gray-400");
    });
    currentIndex = 0; // always start at index 0 of sorted list
  }

  function init() {
    const el = getTextEl();
    if (!el) return;
    letters = splitIntoWords(el);

    const computedDir =
      getComputedStyle(el).direction ||
      el.dir ||
      document.documentElement.dir ||
      "ltr";
    isRTL = computedDir === "rtl";

    // sort by real visual order
    letters = sortByPosition(letters, isRTL);

    resetLettersState();
  }

  function isElementMostlyVisible(el) {
    if (!el) return false;
    const rect = el.getBoundingClientRect();
    if (rect.bottom <= 0 || rect.top >= window.innerHeight) return false;
    const visibleHeight =
      Math.min(rect.bottom, window.innerHeight) - Math.max(rect.top, 0);
    const ratio = visibleHeight / rect.height;
    return ratio >= visibilityRatio;
  }

  function revealStep(maxChars) {
    let revealed = 0;
    while (revealed < maxChars && currentIndex < letters.length) {
      if (!isElementMostlyVisible(letters[currentIndex])) break;
      letters[currentIndex].classList.remove("text-gray-400");
      letters[currentIndex].classList.add("text-black");
      currentIndex++;
      revealed++;
    }
    if (currentIndex >= letters.length) {
      animationFinished = true;
    }
    return revealed;
  }

  function startAutoReveal() {
    if (autoRevealStarted) return;
    autoRevealStarted = true;
    autoRevealInterval = setInterval(() => {
      if (animationFinished) {
        clearInterval(autoRevealInterval);
        return;
      }
      if (
        letters[currentIndex] &&
        isElementMostlyVisible(letters[currentIndex])
      ) {
        revealStep(charsPerScroll);
      }
    }, 250);
  }

  function observeSectionCenter() {
    const section = document.getElementById("animated-section");
    if (!section) return;
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
            startAutoReveal();
            observer.disconnect();
          }
        });
      },
      {
        threshold: [0.5],
      }
    );
    observer.observe(section);
  }

  function attachTranslationListener() {
    if (window.i18next && typeof window.i18next.on === "function") {
      window.i18next.on("languageChanged", () => {
        setTimeout(() => {
          init();
        }, 0);
      });
    } else {
      const el = getTextEl();
      if (!el) return;
      const mo = new MutationObserver(() => {
        init();
      });
      mo.observe(el, {
        childList: true,
        characterData: true,
        subtree: true,
      });
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      init();
      attachTranslationListener();
      observeSectionCenter();
    });
  } else {
    init();
    attachTranslationListener();
    observeSectionCenter();
  }
})();

window.addEventListener("load", () => {
  const heroTitle = document.getElementById("hero-title");

  // Reveal hero text slightly later for staggered effect
  setTimeout(() => {
    heroTitle.classList.add("show");
  }, 100);
});

gsap.registerPlugin(ScrollTrigger);
function initAnimations() {
  // Kill all old ScrollTriggers
  ScrollTrigger.getAll().forEach((trigger) => trigger.kill());

  // Clear inline gsap styles (opacity, transform, etc.)
  gsap.set(["#panel-container", "#statistics-content"], {
    clearProps: "all",
  });

  const langSelected = document.documentElement.lang;
  const xCordinate = langSelected === "ar" ? 1800 : -200; // reduced from 12000 so it doesn't fly off screen

  ["#panel-container", "#statistics-content"].forEach((selector) => {
    gsap.from(selector, {
      scrollTrigger: {
        trigger: selector,
        start: "top bottom",
        toggleActions: "play none none none",
      },
      x: xCordinate,
      opacity: 0,
      duration: 1.2,
      ease: "power3.out",
    });
  });
}

// Run initially
document.addEventListener("DOMContentLoaded", initAnimations);

// Re-run after i18next changes language
i18next.on("languageChanged", function (lng) {
  document.documentElement.lang = lng; // update <html lang="...">

  // Wait a tiny bit to let i18next update the text before re-init animations
  setTimeout(() => {
    initAnimations();
  }, 50);
});

// Footer Animation

document.addEventListener("DOMContentLoaded", function () {
  let lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
  let footerShown = false;
  const footer = document.getElementById("animatedFooter");
  const pageOverlay = document.getElementById("pageOverlay");
  let scrollTimer = null;
  const threshold = 400; // px to consider "at bottom"

  // safety: ensure elements exist
  if (!footer || !pageOverlay) return;

  // Force hidden state & opacity at load
  footer.classList.remove("active");
  pageOverlay.classList.remove("active");
  footerShown = false;

  // After a tiny delay remove hidden-init to allow CSS transitions
  setTimeout(() => {
    footer.classList.remove("hidden-init");
  }, 200);

  function isAtBottom() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const clientHeight =
      window.innerHeight || document.documentElement.clientHeight;
    const scrollHeight = Math.max(
      document.body.scrollHeight,
      document.documentElement.scrollHeight
    );
    return scrollTop + clientHeight >= scrollHeight - threshold;
  }

  function showFooter() {
    if (footerShown) return;
    footer.classList.add("active");
    pageOverlay.classList.add("active");
    footerShown = true;
  }

  function hideFooter() {
    if (!footerShown) return;
    footer.classList.remove("active");
    pageOverlay.classList.remove("active");
    footerShown = false;
  }

  window.addEventListener(
    "scroll",
    function () {
      const currentScrollTop =
        window.pageYOffset || document.documentElement.scrollTop;

      // capture previous scroll position for the debounced check
      const prevScrollTop = lastScrollTop;

      // Instant hide when scrolling up
      if (currentScrollTop < prevScrollTop - 5 && footerShown) {
        hideFooter();
      }

      // Debounced show at bottom ONLY when scrolling down from the previous position
      clearTimeout(scrollTimer);
      scrollTimer = setTimeout(function () {
        // Show only if user was moving down (current > prev) AND we're at bottom
        if (currentScrollTop > prevScrollTop && isAtBottom()) {
          showFooter();
        } else if (!isAtBottom()) {
          // If we've left the bottom area, ensure footer is hidden
          hideFooter();
        }
        // update lastScrollTop after debounce so prevScrollTop stays meaningful
        lastScrollTop = currentScrollTop;
      }, 80);

      // do NOT set lastScrollTop here (we update it inside the debounced handler)
    },
    { passive: true }
  );

  // Click overlay to hide footer
  pageOverlay.addEventListener("click", function () {
    hideFooter();
    window.scrollBy({ top: -120, left: 0, behavior: "smooth" });
  });

  // Ensure footer shows/hides on resize/orientation change if needed
  window.addEventListener("resize", () => {
    if (isAtBottom()) showFooter();
    else hideFooter();
  });

  // keyboard escape closes footer
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") hideFooter();
  });
});

// ------------------ Animations End --------------------
;
